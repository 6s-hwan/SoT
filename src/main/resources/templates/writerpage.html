<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" th:href="@{/css/writerpage.css}" />
  <link rel="stylesheet" th:href="@{https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css}" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet" />
  <title>writerpage Page</title>
</head>
<body>
<nav class="navbar">
  <div class="nav_logo">
    <div id="nav_logo1">
      <a th:href="@{/test}">
        <img th:src="@{/images/MainLogo.png}" alt="로고" width="225px" height="60px" />
      </a>
    </div>
    <div class="nav_menu">
      <ul class="navigation">
        <li><a href="./test" class="b">홈</a></li>
        <li><a href="" class="c">지역</a></li>
        <li><a href="" class="c">북마크</a></li>
      </ul>
    </div>
    <div id="search">
      <input type="search" class="search" />
      <img th:src="@{/images/search.png}" alt="돋보기" width="30px" height="30px" />
    </div>
    <input type="button" class="uploadbtn" />
    <input type="button" class="imagebtn" onclick="location.href='writerpage.html' " />
    <input type="checkbox" id="join" />
    <label for="join">로그인</label>
  </div>
</nav>

<div id="writerpagefull">
  <div id="writerpage">
    <div id="writerpageTitle">
      <p id="writerpage_title">작가 프로필</p>
      <img th:src="@{/images/listicon.png}" alt="목록보기" id="listicon" width="18px" height="18px" />
      <p id="writerlist"><a th:href="@{/popular}">목록보기</a></p>
    </div>

    <div id="writerpageprofilefull">
      <div id="writerpageprofile">
        <img th:src="@{/images/writerprofile.png}" alt="프로필" width="200px" height="200px" style="border: 0px" />
      </div>
      <div id="writerpagedetail">
        <div id="writerpagedetail_1">
          <div id="writerpageusername">
            <p id="username" th:text="${user.username}">Username</p>
          </div>
          <button id="followBtn" class="follow" onclick="toggleFollow()">
            <p id="writerpagefollowertext">0</p>
            <p id="centerbar"></p>
            <span id="followText">팔로우</span>
          </button>
        </div>
        <div id="writerpagedetail_2">
          <!-- 스토리 수 -->
          <p id="writerpagedetail_2name">스토리&nbsp</p>
          <p id="writerpagedetail_2number" th:text="${totalStories}">0</p>
          <!-- 좋아요 수 -->
          <p id="writerpagedetail_2name">좋아요&nbsp</p>
          <p id="writerpagedetail_2number" th:text="${totalLikes}">0</p>
          <!-- 조회수 수 -->
          <p id="writerpagedetail_2name">조회수&nbsp</p>
          <p id="writerpagedetail_2number" th:text="${totalViews}">0</p>
        </div>
        <div id="writerpagedetail_3">
          <div id="majortheme">
            <p id="writerpagethemename">주요 테마</p>
          </div>
          <div id="writerpagetag">
            <p id="writerpagetagname" th:text="'#' + ${topTheme}">주요 테마</p>
          </div>
          <div id="writerpagetag">
            <p id="writerpagetagname" th:text="'#' + ${secondTheme}">주요 테마</p>
          </div>
        </div>
        <div id="writerpagedetail_4">
          <p id="newestupload">최근 업로드</p>
          <p id="newestuploaddate" th:text="${daysSinceLastUpload} + '일전'">최근 업로드</p>
        </div>
      </div>
    </div>
    <div id="writerpage_select">
      <form>
        <select
                name="story_select"
                id="story_select"
                onchange="sortStories()"
        >
          <option value="likes" class="recom_select">추천순</option>
          <option value="recent" class="newest_select">최신순</option>
          <option value="views" class="inquiry_select">조회순</option>
        </select>
      </form>
    </div>

    <div id="back">
      <div class="stories" th:each="story, iterStat : ${stories}">
        <div class="story">
          <a th:href="@{/story/{storyId}(storyId=${story.storyId})}">
            <img id="storyimage" th:src="${story.image_url}" alt="Story Image" />
            <div id="storyTitlefull">
              <p id="storyTitle" th:text="${story.title}">Story Title</p>
              <img th:src="@{/images/seeimg.png}" class="seeimage" width="16px" height="16px" />
              <p class="seeimagetext" th:text="${story.viewCount}">0</p>
              <img th:src="@{/images/likeimg.png}" class="likeimage" width="14px" height="14px" />
              <p class="likeimagetext" th:text="${story.likes.size()}">0</p>
            </div>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function sortStories() {
    var select = document.getElementById("story_select");
    var sort = select.value;
    var username = document.getElementById("username").innerText; // Get username
    window.location.href = "/writer/" + username + "?sort=" + sort; // Redirect to /writer/username?sort=
  }

  document.addEventListener("DOMContentLoaded", function () {
    var params = new URLSearchParams(window.location.search);
    var sort = params.get("sort");
    if (sort) {
      document.getElementById("story_select").value = sort;
    }
  });

  function toggleFollow() {
    const followBtn = document.getElementById("followBtn");
    const followText = document.getElementById("followText");
    const followerCountElement = document.getElementById("writerpagefollowertext");
    let followerCount = parseInt(followerCountElement.innerText);

    followBtn.classList.toggle("following");

    if (followBtn.classList.contains("following")) {
      followText.innerText = "팔로잉";
      followerCountElement.innerText = followerCount + 1;
    } else {
      followText.innerText = "팔로우";
      followerCountElement.innerText = followerCount - 1;
    }
  }
</script>

</body>
</html>
